<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud-Native Journey | atvantage</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;300;400;500;600&family=Space+Grotesk:wght@300;400;700&display=swap');

        :root {
            --atv-orange: #f97316;
            --bg-dark: #050810;
        }

        /* Sanftes Scrollen */
        html {
            scroll-behavior: smooth;
        }

        body {
            background-color: var(--bg-dark);
            color: #f8fafc;
            font-family: 'Plus Jakarta Sans', sans-serif;
            margin: 0;
        }

        /* Fixierter Hintergrund */
        #site-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(rgba(5, 8, 16, 0.9), rgba(5, 8, 16, 0.9)),
                url('background.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        h1,
        h2 {
            font-family: 'Space Grotesk', sans-serif;
        }

        /* Titelseite */
        .hero-title {
            font-weight: 200;
            font-size: clamp(1.6rem, 4vw, 2.5rem);
            letter-spacing: -0.01em;
            color: #ffffff;
            line-height: 1.2;
        }

        .hero-subtitle {
            font-weight: 300;
            font-size: 0.8rem;
            letter-spacing: 0.4em;
            text-transform: uppercase;
            color: var(--atv-orange);
            opacity: 0.9;
        }

        /* Button Styling */
        .atv-btn {
            background-color: var(--atv-orange);
            color: white;
            padding: 0.7rem 2.2rem;
            border-radius: 0.375rem;
            font-size: 0.8rem;
            font-weight: 500;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(249, 115, 22, 0.2);
            display: inline-flex;
            align-items: center;
            gap: 0.6rem;
            text-decoration: none;
        }

        .atv-btn:hover {
            background-color: #fb923c;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(249, 115, 22, 0.4);
        }

        /* Liniennetz Bereich */
        #map-container {
            position: relative;
            width: 100%;
            max-width: 1100px;
            height: 50vh;
            background: transparent;
            margin: 0 auto;
        }

        /* Tooltip */
        #canvas-tooltip {
            position: fixed;
            pointer-events: none;
            background: rgba(15, 23, 42, 0.95);
            color: #fff;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: none;
            z-index: 500;
        }

        /* Popup */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal-content {
            background: #0f172a;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0;
            border-radius: 1.25rem;
            max-width: 950px;
            width: 100%;
            max-height: 85vh;
            overflow: hidden;
            position: relative;
            box-shadow: 0 40px 100px -20px rgba(0, 0, 0, 0.8);
        }

        .close-btn {
            position: absolute;
            top: 1.25rem;
            right: 1.5rem;
            color: #94a3b8;
            cursor: pointer;
            font-size: 1.5rem;
            z-index: 50;
            transition: color 0.2s;
        }

        .close-btn:hover {
            color: #fff;
        }

        /* Popup Content Styles */
        .popup-header-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--atv-orange);
            margin-bottom: 1.5rem;
            line-height: 1.2;
            font-family: 'Space Grotesk', sans-serif;
        }

        .popup-description {
            color: #cbd5e1;
            font-size: 1.1rem;
            line-height: 1.7;
        }

        .popup-visual-container {
            background: #050810;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem 2rem;
            height: 100%;
        }

        /* Taxi Hinweis Box */
        .taxi-note {
            max-width: 850px;
            margin: 4rem auto 0;
            padding: 1.25rem 2rem;
            border-left: 3px solid var(--atv-orange);
            background: rgba(249, 115, 22, 0.04);
            border: 1px solid rgba(249, 115, 22, 0.1);
            border-left-width: 3px;
            color: #f8fafc;
            font-size: 0.9rem;
            border-radius: 0.4rem 1.2rem 1.2rem 0.4rem;
        }

        @media (max-width: 768px) {
            .modal-content {
                overflow-y: auto;
            }

            .border-r-atv {
                border-right: none !important;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .popup-visual-container {
                padding: 3rem 1rem;
            }
        }
    </style>
</head>

<body>

    <div id="site-bg"></div>
    <div id="canvas-tooltip">Details anzeigen</div>

    <!-- Titelfolie -->
    <section class="h-screen flex flex-col items-center justify-center text-center p-6">
        <p class="hero-subtitle mb-3">atvantage pr√§sentiert</p>
        <h1 class="hero-title mb-1">Cloud-Native-Entwicklung</h1>
        <p class="text-lg md:text-xl font-light text-slate-400 mb-10 italic">Mit der U-Bahn üöä in die Wolken ‚úàÔ∏è‚òÅÔ∏è</p>

        <div class="max-w-xl text-slate-400 font-light leading-relaxed mb-10 text-base px-4 opacity-90">
            <p class="mb-4 text-slate-300">Willkommen an Board auf Deiner individuellen Reise in die Welt der
                Cloud-Native-Entwicklung.</p>
            <p>W√§hle die f√ºr Dich passende Verbindung. Jede Station h√§lt neue Impulse bereit.</p>
        </div>

        <a href="#map-section" class="atv-btn">
            Zum Liniennetz <i class="fa-solid fa-chevron-down ml-2 text-[10px]"></i>
        </a>
    </section>

    <!-- Seite 2: Liniennetz -->
    <section id="map-section" class="min-h-screen flex flex-col items-center justify-start pt-8 pb-4 px-4">
        <div class="text-center mb-4">
            <h2 class="text-3xl font-light mb-1 tracking-tight">Liniennetz</h2>
            <p class="text-slate-500 uppercase tracking-widest text-[9px] font-semibold mb-4">Interaktive
                Haltestellen√ºbersicht</p>

            <div id="legend-container"
                class="flex flex-wrap justify-center gap-x-8 gap-y-4 opacity-90 text-[11px] uppercase tracking-widest font-bold mb-6">
                <!-- Wird per JS dynamisch gef√ºllt -->
            </div>
        </div>

        <div id="map-container">
            <canvas id="metroCanvas"></canvas>
        </div>

        <div class="taxi-note">
            <div class="flex flex-col md:flex-row items-center gap-6">
                <i class="fa-solid fa-taxi text-2xl text-orange-500/70"></i>
                <div class="flex-1 text-center md:text-left">
                    <p class="mb-1 leading-relaxed">Nicht die passende Station gefunden? Unser
                        <strong>Individual-Schulungs-Taxi</strong> bringt Dich direkt an Deine Adresse.</p>
                </div>
                <button onclick="sendConsultationEmail()" class="atv-btn py-2 px-6 text-[10px]">
                    Beratung anfragen <i class="fa-solid fa-paper-plane ml-2 text-[8px]"></i>
                </button>
            </div>
        </div>
    </section>

    <!-- Modal f√ºr Popups -->
    <div id="detailModal" class="modal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="toggleModal(false)"><i class="fa-solid fa-xmark"></i></span>
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        // --- DATEN ---
        const fallbackData = {
            "stations": [
                { "id": "pipeline-platz", "title": "Pipeline-Platz", "subtitle": "DevOps ‚Äì Spirit und Tools", "description": "Lerne die Grundlagen von DevOps, CI/CD und Cloud-Native-Entwicklung praxisnah mit Git, Maven/NPM, Jenkins und Nexus." },
                { "id": "api-allee", "title": "API-Allee", "subtitle": "Design von RESTful APIs", "description": "Tauche in die Grundlagen moderner REST-APIs ein ‚Äì von den Prinzipien bis zur Dokumentation mit OpenAPI." },
                { "id": "lambda-lane", "title": "Lambda-Lane (√ºber Garbage-Gasse)", "subtitle": "Java-Vertiefung", "description": "Auffrischung von Java-Grundlagen und √úbung spezieller Sprach-Features f√ºr anstehende Framework-Kurse." },
                { "id": "mockstadt", "title": "Mockstadt (am Testfalltor)", "subtitle": "Java ‚Äì Automatisierte Tests", "description": "Lerne mit JUnit, Mockito und AssertJ aussagekr√§ftige Tests zu schreiben und TDD anzuwenden." },
                { "id": "springfield-ortseingang", "title": "Springfield (Ortseingang)", "subtitle": "Spring Boot Grundlagen", "description": "Entwickle REST-APIs mit Spring Web MVC und JPA inklusive Datenbankanbindung." },
                { "id": "springfield-clean-code-kreuz", "title": "Springfield (Clean-Code-Kreuz)", "subtitle": "Spring Boot Vertiefung", "description": "Code-Optimierung nach Clean-Code-Prinzipien und Einsatz moderner Konzepte wie Events und AOP." },
                { "id": "supersonic-steig", "title": "Supersonic-Steig (Am DevMode-Dock)", "subtitle": "Quarkus Grundlagen", "description": "Ressourceneffiziente Java-Entwicklung mit Quarkus und Native Compilation." },
                { "id": "topic-tor", "title": "Zum Topic-Tor", "subtitle": "Kafka Kommunikation", "description": "Event-basierte Kommunikation zwischen Microservices mit Apache Kafka effizient gestalten." },
                { "id": "docker-dock", "title": "Am Docker-Dock", "subtitle": "Docker Grundlagen", "description": "Grundlagen der Containerisierung und Integration von Images in CI/CD-Pipelines." },
                { "id": "podstetten", "title": "Podstetten (Containerhof)", "subtitle": "Kubernetes & OpenShift", "description": "Container-Orchestrierung und Deployment in der HUK-spezifischen OpenShift-Umgebung." },
                { "id": "ng-zone", "title": "NG-Zone", "subtitle": "Angular-Grundlagen", "description": "Moderne Frontend-Entwicklung mit TypeScript, Angular Komponenten, RxJS und automatisierten Tests." }
            ],
            "lines": [
                { "id": "42", "name": "DevOps-Grundlagen", "stations": ["pipeline-platz", "api-allee", "docker-dock", "podstetten"] },
                { "id": "8080", "name": "Backend Developer (Spring)", "stations": ["api-allee", "springfield-ortseingang", "springfield-clean-code-kreuz", "topic-tor", "docker-dock"] },
                { "id": "1024", "name": "Backend Developer (Quarkus)", "stations": ["api-allee", "supersonic-steig", "topic-tor", "docker-dock"] },
                { "id": "1010", "name": "Frontend Developer", "stations": ["api-allee", "ng-zone", "docker-dock"] },
                { "id": "1337", "name": "Java-Auffrischung", "stations": ["lambda-lane", "mockstadt", "api-allee"] }
            ]
        };

        const lineColors = { "42": "#3b82f6", "8080": "#a855f7", "1024": "#10b981", "1010": "#f97316", "1337": "#ec4899" };

        // Optimierte Koordinaten zur Vermeidung von Linien√ºberschneidungen
        const coordinateMap = {
            "pipeline-platz": { x: 0.15, y: 0.3 },
            "api-allee": { x: 0.35, y: 0.3 },
            "ng-zone": { x: 0.55, y: 0.45 },
            "docker-dock": { x: 0.75, y: 0.3 },
            "podstetten": { x: 0.92, y: 0.3 },
            "lambda-lane": { x: 0.15, y: 0.65 },
            "mockstadt": { x: 0.35, y: 0.65 },
            "springfield-ortseingang": { x: 0.48, y: 0.7 }, // Springfield weiter nach links/unten
            "springfield-clean-code-kreuz": { x: 0.60, y: 0.7 },
            "supersonic-steig": { x: 0.40, y: 0.9 }, // Quarkus Pfad deutlich separiert
            "topic-tor": { x: 0.75, y: 0.55 } // Exakt unter Docker-Dock
        };

        let activeData = fallbackData;
        const canvas = document.getElementById('metroCanvas');
        const ctx = canvas.getContext('2d');
        const modal = document.getElementById('detailModal');
        const modalBody = document.getElementById('modal-body');
        const tooltip = document.getElementById('canvas-tooltip');
        let hoveredStationId = null;

        async function initData() {
            try {
                const response = await fetch('lines.json');
                if (response.ok) activeData = await response.json();
            } catch (e) { console.warn("Laden von lines.json fehlgeschlagen, nutze Fallback."); }
            renderLegend();
            resize();
        }

        function renderLegend() {
            document.getElementById('legend-container').innerHTML = activeData.lines.map(line => {
                const color = lineColors[line.id] || '#fff';
                return `
                <div class="flex items-center">
                    <div class="px-2 py-0.5 rounded border text-[11px] font-bold z-10" 
                         style="background-color: #050810; border-color: ${color}; color: #fff; min-width: 28px; text-align: center;">
                        ${line.id}
                    </div>
                    <div class="h-1 w-6 -ml-px shadow-[0_0_8px_${color}44]" style="background-color: ${color};"></div>
                    <span class="ml-3 text-slate-300 tracking-tight normal-case font-medium">${line.name}</span>
                </div>
                `;
            }).join('');
        }

        function sendConsultationEmail() {
            const u = "competence-center", d = "atvantage.com";
            const s = encodeURIComponent("Anfrage: Individuelle Cloud-Native Beratung");
            const b = encodeURIComponent("Hallo Competence Center Team,\n\nich interessiere mich f√ºr eine individuelle Beratung zum Cloud-Native Trainingsfahrplan.\n\nBitte nehmen Sie Kontakt mit mir auf.");
            window.location.href = `mailto:${u}@${d}?subject=${s}&body=${b}`;
        }

        function sendInterestEmail(stationTitle, subtitle) {
            const u = "competence-center", d = "atvantage.com";
            const s = encodeURIComponent(`Interesse am Kurs ${subtitle}`);
            const b = encodeURIComponent(`Hallo Competence Center Team,\n\nich habe Interesse am Kurs "${subtitle}" (Haltestelle: ${stationTitle}) und bitte daher um n√§here Details.\n\nMit freundlichen Gr√º√üen`);
            window.location.href = `mailto:${u}@${d}?subject=${s}&body=${b}`;
        }

        function resize() {
            const container = document.getElementById('map-container');
            if (!container) return;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            draw();
        }

        function fillRoundRect(x, y, w, h, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + w - radius, y);
            ctx.quadraticCurveTo(x + w, y, x + w, y + radius);
            ctx.lineTo(x + w, y + h - radius);
            ctx.quadraticCurveTo(x + w, y + h, x + w - radius, y + h);
            ctx.lineTo(x + radius, y + h);
            ctx.quadraticCurveTo(x, y + h, x, y + h - radius);
            ctx.lineTo(x, y + radius);
            ctx.quadraticCurveTo(x, y, x + radius, y);
            ctx.closePath();
            ctx.fill(); ctx.stroke();
        }

        function getAugmentedSegments(line) {
            const segments = [];
            for (let i = 0; i < line.stations.length - 1; i++) {
                const s1 = line.stations[i];
                const s2 = line.stations[i + 1];
                const p1 = coordinateMap[s1];
                const p2 = coordinateMap[s2];
                if (!p1 || !p2) continue;

                const intermediate = activeData.stations
                    .filter(s => s.id !== s1 && s.id !== s2)
                    .map(s => ({ id: s.id, pos: coordinateMap[s.id] }))
                    .filter(s => {
                        if (!s.pos) return false;
                        const cross = (s.pos.y - p1.y) * (p2.x - p1.x) - (s.pos.x - p1.x) * (p2.y - p1.y);
                        if (Math.abs(cross) > 0.01) return false;
                        const dot = (s.pos.x - p1.x) * (p2.x - p1.x) + (s.pos.y - p1.y) * (p2.y - p1.y);
                        if (dot < 0) return false;
                        const squaredLength = Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2);
                        return dot < squaredLength;
                    })
                    .sort((a, b) => {
                        const distA = Math.pow(a.pos.x - p1.x, 2) + Math.pow(a.pos.y - p1.y, 2);
                        const distB = Math.pow(b.pos.x - p1.x, 2) + Math.pow(b.pos.y - p1.y, 2);
                        return distA - distB;
                    });

                let lastId = s1;
                intermediate.forEach(inter => {
                    segments.push({ from: lastId, to: inter.id });
                    lastId = inter.id;
                });
                segments.push({ from: lastId, to: s2 });
            }
            return segments;
        }

        function getParallelLinesOnSegment(fromId, toId) {
            return activeData.lines.filter(line => {
                const segments = getAugmentedSegments(line);
                return segments.some(seg => (seg.from === fromId && seg.to === toId) || (seg.from === toId && seg.to === fromId));
            });
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const w = canvas.width, h = canvas.height;
            const lineGap = 6;

            // Individuelle Verl√§ngerung zur Entzerrung der Startnummern
            const getExtension = (lid) => lid === "8080" ? 80 : 40;

            // 1. Linienstriche zeichnen
            activeData.lines.forEach(line => {
                const col = lineColors[line.id] || '#fff';
                ctx.strokeStyle = col;
                ctx.lineWidth = 4;
                ctx.lineCap = 'round'; ctx.lineJoin = 'round';

                const segments = getAugmentedSegments(line);

                segments.forEach((seg, i) => {
                    const p1 = coordinateMap[seg.from];
                    const p2 = coordinateMap[seg.to];
                    if (!p1 || !p2) return;

                    const shared = getParallelLinesOnSegment(seg.from, seg.to);
                    const lineIdx = shared.findIndex(l => l.id === line.id);
                    const totalShared = shared.length;
                    const offsetVal = (lineIdx - (totalShared - 1) / 2) * lineGap;

                    const dx = (p2.x - p1.x) * w;
                    const dy = (p2.y - p1.y) * h;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist === 0) return;

                    const nx = -dy / dist;
                    const ny = dx / dist;

                    let xStart = p1.x * w + nx * offsetVal;
                    let yStart = p1.y * h + ny * offsetVal;
                    let xEnd = p2.x * w + nx * offsetVal;
                    let yEnd = p2.y * h + ny * offsetVal;

                    if (i === 0 && seg.from === line.stations[0]) {
                        const vx = -(dx / dist);
                        const vy = -(dy / dist);
                        xStart += vx * getExtension(line.id);
                        yStart += vy * getExtension(line.id);
                    }

                    ctx.beginPath();
                    ctx.moveTo(xStart, yStart);
                    ctx.lineTo(xEnd, yEnd);
                    ctx.stroke();
                });
            });

            // 2. Liniennummern (Boxen) zeichnen
            activeData.lines.forEach(line => {
                const col = lineColors[line.id] || '#fff';
                const firstSId = line.stations[0];
                const secondSId = line.stations[1];
                const p1 = coordinateMap[firstSId];
                const p2 = coordinateMap[secondSId];
                if (!p1 || !p2) return;

                const shared = getParallelLinesOnSegment(firstSId, secondSId);
                const lineIdx = shared.findIndex(l => l.id === line.id);
                const totalShared = shared.length;
                const offsetVal = (lineIdx - (totalShared - 1) / 2) * lineGap;

                const dx = (p2.x - p1.x) * w;
                const dy = (p2.y - p1.y) * h;
                const dist = Math.sqrt(dx * dx + dy * dy);
                const nx = -dy / dist;
                const ny = dx / dist;

                const xBase = p1.x * w + nx * offsetVal;
                const yBase = p1.y * h + ny * offsetVal;

                const vx = -(dx / dist);
                const vy = -(dy / dist);
                const tipX = xBase + vx * getExtension(line.id);
                const tipY = yBase + vy * getExtension(line.id);

                ctx.save();
                ctx.font = 'bold 11px Space Grotesk';
                const idText = line.id;
                const idWidth = ctx.measureText(idText).width;
                const bPadding = 5;
                const bW = idWidth + bPadding * 2;
                const bH = 16;
                const bX = tipX - bW / 2;
                const bY = tipY - bH / 2;

                ctx.fillStyle = '#050810';
                ctx.strokeStyle = col;
                ctx.lineWidth = 1.5;
                fillRoundRect(bX, bY, bW, bH, 3);

                ctx.fillStyle = '#fff';
                ctx.textAlign = 'center';
                ctx.fillText(idText, tipX, tipY + 4);
                ctx.restore();
            });

            // 3. Stationen zeichnen
            activeData.stations.forEach(s => {
                const pos = coordinateMap[s.id];
                if (!pos) return;
                const px = pos.x * w, py = pos.y * h;
                const isHovered = s.id === hoveredStationId;

                if (isHovered) {
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = 'rgba(255, 255, 255, 0.8)';
                }

                ctx.beginPath();
                ctx.arc(px, py, 14, 0, Math.PI * 2);
                ctx.fillStyle = '#050810'; ctx.fill();
                ctx.strokeStyle = isHovered ? '#fff' : 'rgba(255,255,255,0.7)';
                ctx.lineWidth = isHovered ? 2 : 1.2;
                ctx.stroke();

                ctx.beginPath();
                ctx.arc(px, py, 5, 0, Math.PI * 2);
                ctx.fillStyle = '#fff'; ctx.fill();

                ctx.font = '600 11px Plus Jakarta Sans';
                const textWidth = ctx.measureText(s.title).width;
                const boxW = textWidth + 14;
                const boxH = 18;
                const boxX = px - boxW / 2;
                const boxY = py + 22;

                ctx.fillStyle = '#050810';
                ctx.strokeStyle = isHovered ? '#fff' : 'rgba(255,255,255,0.4)';
                ctx.lineWidth = 1;
                fillRoundRect(boxX, boxY, boxW, boxH, 4);

                ctx.fillStyle = isHovered ? '#fff' : '#f8fafc';
                ctx.textAlign = 'center';
                ctx.fillText(s.title, px, boxY + 12.5);
                ctx.shadowBlur = 0;
            });
        }

        function getMousePos(e) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: (e.clientX || (e.touches && e.touches[0].clientX)) - rect.left,
                y: (e.clientY || (e.touches && e.touches[0].clientY)) - rect.top
            };
        }

        function getStationAtPos(pos) {
            const w = canvas.width, h = canvas.height;
            for (const s of activeData.stations) {
                const c = coordinateMap[s.id];
                if (!c) continue;
                const px = c.x * w, py = c.y * h;
                const distToCircle = Math.sqrt(Math.pow(pos.x - px, 2) + Math.pow(pos.y - py, 2));
                ctx.font = '600 11px "Plus Jakarta Sans"';
                const textWidth = ctx.measureText(s.title).width;
                const boxW = textWidth + 14;
                const inCompositeArea = pos.x >= (px - boxW / 2) && pos.x <= (px + boxW / 2) && pos.y >= py && pos.y <= py + 40;
                if (distToCircle < 20 || inCompositeArea) return s;
            }
            return null;
        }

        function handleMouseMove(e) {
            const pos = getMousePos(e);
            const s = getStationAtPos(pos);
            if (s) {
                if (hoveredStationId !== s.id) {
                    hoveredStationId = s.id;
                    canvas.style.cursor = 'pointer';
                    draw();
                }
                tooltip.style.left = (e.clientX + 15) + 'px';
                tooltip.style.top = (e.clientY + 15) + 'px';
                tooltip.style.display = 'block';
            } else {
                if (hoveredStationId !== null) {
                    hoveredStationId = null;
                    canvas.style.cursor = 'default';
                    tooltip.style.display = 'none';
                    draw();
                }
            }
        }

        function handleInteraction(e) {
            const pos = getMousePos(e);
            const s = getStationAtPos(pos);
            if (s) {
                modalBody.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-[1.5fr_1fr] max-h-[85vh]">
                        <div class="p-10 md:p-12 border-r border-white/10 border-r-atv overflow-y-auto max-h-[85vh]">
                            <h1 class="popup-header-title">${s.subtitle}</h1>
                            <div class="popup-description">
                                <p>${s.description}</p>
                            </div>
                        </div>
                        <div class="popup-visual-container">
                            <div class="relative flex flex-col items-center">
                                <div class="w-16 h-16 rounded-full border-4 border-white/70 bg-[#050810] flex items-center justify-center shadow-[0_0_20px_rgba(255,255,255,0.1)]">
                                    <div class="w-4 h-4 rounded-full bg-white"></div>
                                </div>
                                <div class="mt-6 px-4 py-2 bg-[#050810] border border-white/20 rounded-lg shadow-lg">
                                    <span class="text-white font-semibold text-sm tracking-tight">${s.title}</span>
                                </div>
                                <div class="mt-12">
                                    <button onclick="sendInterestEmail('${s.title}', '${s.subtitle}')" class="atv-btn py-3 px-8 text-[11px] whitespace-nowrap">
                                        Das interessiert mich <i class="fa-solid fa-chevron-right ml-2 text-[9px]"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                toggleModal(true);
                tooltip.style.display = 'none';
            }
        }

        function toggleModal(show) {
            document.getElementById('detailModal').style.display = show ? 'flex' : 'none';
            document.body.style.overflow = show ? 'hidden' : 'auto';
        }
        function closeModal(e) { if (e.target.id === 'detailModal') toggleModal(false); }

        window.addEventListener('resize', resize);
        canvas.addEventListener('mousemove', handleMouseMove);
        canvas.addEventListener('mousedown', handleInteraction);
        canvas.addEventListener('touchstart', (e) => {
            const pos = getMousePos(e);
            const s = getStationAtPos(pos);
            if (s) { e.preventDefault(); handleInteraction(e); }
        });

        window.onload = initData;
    </script>
</body>

</html>