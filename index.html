<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cloud-Native Journey | atvantage</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;300;400;500;600&family=Space+Grotesk:wght@300;400;700&display=swap');

        :root {
            --atv-orange: #f97316;
            --bg-dark: #050810;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background-color: var(--bg-dark);
            color: #f8fafc;
            font-family: 'Plus Jakarta Sans', sans-serif;
            margin: 0;
            overflow-x: hidden;
            overflow-y: auto;
        }

        /* Hintergrund mit Priorit√§t auf lokaler Datei */
        #site-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-image: linear-gradient(rgba(5, 8, 16, 0.94), rgba(5, 8, 16, 0.88)),
                url('background.jpg'),
                url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?auto=format&fit=crop&q=80&w=2072');
            background-size: cover;
            background-position: center;
        }

        h1,
        h2 {
            font-family: 'Space Grotesk', sans-serif;
        }

        section {
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Hero / Titelseite Styles */
        .hero-title {
            font-weight: 200;
            font-size: clamp(1.6rem, 4vw, 2.5rem);
            letter-spacing: -0.01em;
            color: #ffffff;
            line-height: 1.2;
        }

        .hero-subtitle {
            font-weight: 300;
            font-size: 0.8rem;
            letter-spacing: 0.4em;
            text-transform: uppercase;
            color: var(--atv-orange);
            opacity: 0.9;
        }

        .atv-btn {
            background-color: var(--atv-orange);
            color: white;
            padding: 0.7rem 2.2rem;
            border-radius: 0.375rem;
            font-size: 0.8rem;
            font-weight: 500;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.6rem;
            text-decoration: none;
            box-shadow: 0 4px 15px rgba(249, 115, 22, 0.2);
        }

        .atv-btn:hover {
            background-color: #fb923c;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(249, 115, 22, 0.4);
        }

        /* Map UI - Stabiler Viewport im Map-Section */
        #map-section {
            height: 100vh;
            /* Fest auf Bildschirmh√∂he */
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #map-viewport {
            flex: 1;
            /* Nimmt den Platz zwischen Header und Footer ein */
            width: 100%;
            overflow: auto;
            background: rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            cursor: grab;
            user-select: none;
            touch-action: none;
        }

        #map-viewport:active {
            cursor: grabbing;
        }

        #canvas-wrapper {
            position: relative;
            padding: 60px;
            /* Sicherer Rand f√ºr Labels */
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        #metroCanvas {
            transform-origin: center center;
            transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Zoom-Controls Fixiert */
        .fixed-zoom-controls {
            position: fixed;
            top: 50%;
            right: 2rem;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .fixed-zoom-controls.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .zoom-btn {
            width: 44px;
            height: 44px;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .zoom-btn:hover {
            background: var(--atv-orange);
            border-color: var(--atv-orange);
            transform: scale(1.05);
        }

        /* Popup Styles */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(12px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
        }

        .modal-content {
            background: #0f172a;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1.5rem;
            max-width: 950px;
            width: 100%;
            max-height: 85vh;
            overflow: hidden;
            position: relative;
            box-shadow: 0 50px 100px -20px rgba(0, 0, 0, 0.9);
        }

        .close-btn {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            color: #94a3b8;
            cursor: pointer;
            font-size: 2rem;
            z-index: 100;
            transition: color 0.2s;
        }

        .close-btn:hover {
            color: #fff;
        }

        .popup-header-title {
            font-size: 2.1rem;
            font-weight: 700;
            color: var(--atv-orange);
            margin-bottom: 0.5rem;
            font-family: 'Space Grotesk', sans-serif;
            line-height: 1.1;
        }

        .popup-subtitle {
            font-size: 1.1rem;
            color: #3b82f6;
            font-weight: 600;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding-bottom: 0.75rem;
        }

        .popup-description {
            color: #cbd5e1;
            font-size: 1.05rem;
            line-height: 1.7;
        }

        .popup-visual-container {
            background: #020617;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem 2rem;
            height: 100%;
        }

        /* Taxi Section */
        .taxi-note {
            max-width: 850px;
            margin: 1rem auto;
            padding: 1rem 2.5rem;
            border-left: 3px solid var(--atv-orange);
            background: rgba(249, 115, 22, 0.04);
            border: 1px solid rgba(249, 115, 22, 0.1);
            border-left-width: 3px;
            color: #f8fafc;
            border-radius: 0.4rem 1.2rem 1.2rem 0.4rem;
            flex-shrink: 0;
        }
    </style>
</head>

<body>

    <div id="site-bg"></div>
    <div id="canvas-tooltip"
        class="fixed pointer-events-none bg-slate-900/95 text-white px-3 py-1.5 rounded text-[10px] font-bold uppercase tracking-wider border border-white/10 hidden z-[500]">
        Details anzeigen</div>

    <div id="ui-controls" class="fixed-zoom-controls">
        <button class="zoom-btn" onclick="zoomIn()" title="Heranzoomen"><i class="fa-solid fa-plus"></i></button>
        <button class="zoom-btn" onclick="zoomOut()" title="Herauszoomen"><i class="fa-solid fa-minus"></i></button>
        <button class="zoom-btn" onclick="resetZoom()" title="Gr√∂√üe anpassen"><i
                class="fa-solid fa-expand"></i></button>
        <button class="zoom-btn mt-4 bg-slate-800" onclick="window.scrollTo({top:0, behavior:'smooth'})"
            title="Zum Anfang"><i class="fa-solid fa-chevron-up"></i></button>
    </div>

    <!-- SEKTION 1: TITEL -->
    <section id="hero-section" class="items-center justify-center text-center p-6">
        <p class="hero-subtitle mb-3">atvantage pr√§sentiert</p>
        <h1 class="hero-title mb-1">Cloud-Native-Entwicklung</h1>
        <p class="text-lg md:text-xl font-light text-slate-400 mb-6 italic">Mit der U-Bahn üöä in die Wolken ‚úàÔ∏è‚òÅÔ∏è</p>

        <div class="max-w-xl text-slate-400 font-light leading-relaxed mb-8 text-base px-4 opacity-90 mx-auto">
            <p class="mb-4 text-slate-300">Willkommen an Board auf Deiner individuellen Reise in die Welt der
                Cloud-Native-Entwicklung.</p>
            <p>W√§hle die f√ºr Dich passende Verbindung. Jede Station h√§lt neue Impulse bereit. Du entscheidest, wo Du
                einsteigen m√∂chtest.</p>
        </div>

        <a href="#map-section" class="atv-btn" onclick="setTimeout(autoFit, 600)">
            Zum Liniennetz <i class="fa-solid fa-chevron-down ml-2 text-[10px]"></i>
        </a>
    </section>

    <!-- SEKTION 2: LINIENNETZ -->
    <section id="map-section">
        <header class="pt-6 pb-4 px-6 text-center shrink-0">
            <h2 class="text-3xl font-light mb-1 tracking-tight">Liniennetz</h2>
            <p class="text-slate-500 uppercase tracking-widest text-[9px] font-semibold mb-4">Interaktive
                Haltestellen√ºbersicht</p>
            <div id="legend-container"
                class="flex flex-wrap justify-center gap-x-8 gap-y-3 opacity-95 text-[11px] uppercase tracking-widest font-bold max-w-5xl mx-auto">
            </div>
        </header>

        <div id="map-viewport">
            <div id="canvas-wrapper">
                <canvas id="metroCanvas"></canvas>
            </div>
        </div>

        <div class="taxi-note">
            <div class="flex flex-col md:flex-row items-center gap-8">
                <div class="text-3xl text-orange-500/80 shrink-0"><i class="fa-solid fa-taxi"></i></div>
                <div class="flex-1 text-center md:text-left">
                    <p class="mb-1 leading-relaxed text-sm">Nicht die passende Station gefunden? Unser
                        <strong>Individual-Schulungs-Taxi</strong> bringt Dich direkt an Deine Adresse.
                    </p>
                </div>
                <button onclick="sendConsultationEmail()" class="atv-btn py-2 px-6 text-[10px]">
                    Beratung anfragen <i class="fa-solid fa-paper-plane ml-2 text-[8px]"></i>
                </button>
            </div>
        </div>
    </section>

    <div id="detailModal" class="modal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="toggleModal(false)"><i class="fa-solid fa-xmark"></i></span>
            <div id="modal-body" class="h-full"></div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const fallbackData = {
            "stations": [
                { "id": "pipeline-platz", "title": "Pipeline-Platz", "subtitle": "DevOps ‚Äì Spirit, Werkzeuge und Infrastruktur", "description": "Lerne die Grundlagen von DevOps, CI/CD und Cloud-Native-Entwicklung ‚Äì praxisnah mit den Tools und Prozessen der HUK." },
                { "id": "api-allee", "title": "API-Allee", "subtitle": "Design von RESTful APIs", "description": "Tauche in die Grundlagen moderner REST-APIs ein ‚Äì von den Prinzipien bis zur Dokumentation mit OpenAPI." },
                { "id": "lambda-lane", "title": "Lambda-Lane (√ºber Garbage-Gasse)", "subtitle": "Java-Vertiefung", "description": "Auffrischung von Java-Grundlagen und √úbung spezieller Sprach-Features." },
                { "id": "mockstadt", "title": "Mockstadt (am Testfalltor)", "subtitle": "Java ‚Äì Automatisierte Tests", "description": "Lerne mit JUnit, Mockito und AssertJ aussagekr√§ftige Tests zu schreiben." },
                { "id": "springfield-ortseingang", "title": "Springfield (Ortseingang)", "subtitle": "Spring Boot ‚Äì Grundlagen", "description": "Entwickle REST-APIs mit Spring Boot inklusive Datenbankanbindung mit JPA." },
                { "id": "springfield-clean-code-kreuz", "title": "Springfield (Clean-Code-Kreuz)", "subtitle": "Spring Boot ‚Äì Vertiefung", "description": "Code-Optimierung nach Clean-Code-Prinzipien und fortgeschrittene Konzepte." },
                { "id": "supersonic-steig", "title": "Supersonic-Steig (Am DevMode-Dock)", "subtitle": "Quarkus ‚Äì Grundlagen", "description": "Baue eine vollst√§ndige REST-API mit Quarkus und JPA." },
                { "id": "topic-tor", "title": "Zum Topic-Tor", "subtitle": "Kafka Kommunikation", "description": "Entdecke, wie Microservices effizient √ºber Kafka kommunizieren." },
                { "id": "docker-dock", "title": "Am Docker-Dock", "subtitle": "Docker Grundlagen", "description": "Lerne die Grundlagen der Containerisierung und Integration in Pipelines." },
                { "id": "podstetten", "title": "Podstetten (Containerhof)", "subtitle": "Kubernetes & OpenShift", "description": "Deployment von Anwendungen in der HUK OpenShift-Umgebung." },
                { "id": "ng-zone", "title": "NG-Zone", "subtitle": "Angular-Grundlagen", "description": "Moderne Frontend-Entwicklung mit Angular, TypeScript und RxJS." }
            ],
            "lines": [
                { "id": "42", "name": "DevOps-Grundlagen", "stations": ["pipeline-platz", "api-allee", "docker-dock", "podstetten"] },
                { "id": "8080", "name": "Backend Developer (Spring)", "color": "#6DB33F", "stations": ["api-allee", "springfield-ortseingang", "springfield-clean-code-kreuz", "topic-tor", "docker-dock"] },
                { "id": "1024", "name": "Backend Developer (Quarkus)", "color": "#4695EB", "stations": ["api-allee", "supersonic-steig", "topic-tor", "docker-dock"] },
                { "id": "1010", "name": "Frontend Developer", "color": "#E40035", "stations": ["api-allee", "ng-zone", "docker-dock"] },
                { "id": "1337", "name": "Java-Auffrischung", "stations": ["lambda-lane", "mockstadt", "api-allee"] }
            ]
        };

        const defaultColors = { "42": "#3b82f6", "1010": "#f97316", "1024": "#a855f7", "8080": "#10b981", "1337": "#ec4899" };
        const lineOrder = ["42", "1010", "1024", "8080", "1337"];

        const coordinateMap = {
            "pipeline-platz": { x: 0.1, y: 0.28 },
            "api-allee": { x: 0.35, y: 0.28 },
            "ng-zone": { x: 0.55, y: 0.48 },
            "docker-dock": { x: 0.75, y: 0.28 },
            "podstetten": { x: 0.9, y: 0.28 },
            "lambda-lane": { x: 0.1, y: 0.68 },
            "mockstadt": { x: 0.3, y: 0.68 },
            "springfield-ortseingang": { x: 0.52, y: 0.68 },
            "springfield-clean-code-kreuz": { x: 0.65, y: 0.68 },
            "supersonic-steig": { x: 0.45, y: 0.88 },
            "topic-tor": { x: 0.75, y: 0.58 }
        };

        let activeData = fallbackData;
        let zoomScale = 1.0;
        const canvas = document.getElementById('metroCanvas');
        const ctx = canvas.getContext('2d');
        const wrapper = document.getElementById('canvas-wrapper');
        const viewport = document.getElementById('map-viewport');
        const modal = document.getElementById('detailModal');
        const modalBody = document.getElementById('modal-body');
        const tooltip = document.getElementById('canvas-tooltip');
        let hoveredStationId = null;

        let isDown = false;
        let startX, startY, scrollLeft, scrollTop;
        let isDragging = false;
        let initialPinchDist = 0;

        function getLineColor(line) {
            return line.color || defaultColors[line.id] || '#ffffff';
        }

        async function initData() {
            try {
                const response = await fetch('lines.json');
                if (response.ok) activeData = await response.json();
            } catch (e) { }
            renderLegend();
            resize();
            autoFit();

            // Initialen Hash pr√ºfen
            handleHash();
        }

        // --- BOOKMARK LOGIC (HASH HANDLING) ---
        function handleHash() {
            const hash = window.location.hash.replace('#', '');
            if (!hash) return;

            if (hash === 'map-section') {
                document.getElementById('map-section').scrollIntoView({ behavior: 'smooth' });
                return;
            }

            const station = activeData.stations.find(s => s.id === hash);
            if (station) {
                // Zur Map scrollen und Popup √∂ffnen
                document.getElementById('map-section').scrollIntoView({ behavior: 'smooth' });
                setTimeout(() => openStationById(station.id), 600);
            }
        }

        window.addEventListener('hashchange', handleHash);

        function openStationById(id) {
            const s = activeData.stations.find(s => s.id === id);
            if (!s) return;

            modalBody.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-[1.5fr_1fr] h-full overflow-hidden">
                    <div class="p-10 md:p-12 border-r border-white/10 overflow-y-auto">
                        <h1 class="popup-header-title">${s.title}</h1>
                        <div class="popup-subtitle">${s.subtitle}</div>
                        <div class="popup-description"><p>${s.description}</p></div>
                    </div>
                    <div class="popup-visual-container flex flex-col items-center justify-center bg-[#020617] h-full">
                        <div class="w-16 h-16 rounded-full border-4 border-white/70 bg-[#050810] flex items-center justify-center shadow-2xl mb-6">
                            <div class="w-4 h-4 rounded-full bg-white"></div>
                        </div>
                        <div class="px-6 py-2 bg-[#050810] border border-white/20 rounded-lg shadow-lg text-center mb-12">
                            <span class="text-white font-semibold text-sm tracking-tight block">${s.title.replace(' (', '<br><span class="text-[10px] font-normal opacity-70">(')}</span>
                        </div>
                        <button onclick="sendInterestEmail('${s.title}', '${s.subtitle}')" class="atv-btn py-3 px-8 text-[11px] whitespace-nowrap">Das interessiert mich <i class="fa-solid fa-chevron-right ml-2 text-[9px]"></i></button>
                    </div>
                </div>`;

            toggleModal(true, s.id);
        }

        // --- NAVIGATION & VISIBILITY ---
        window.addEventListener('scroll', () => {
            const controls = document.getElementById('ui-controls');
            const heroHeight = document.getElementById('hero-section').offsetHeight;
            if (window.scrollY > heroHeight * 0.4) controls.classList.add('visible');
            else controls.classList.remove('visible');
        });

        function renderLegend() {
            document.getElementById('legend-container').innerHTML = activeData.lines.map(line => {
                const color = getLineColor(line);
                return `
                <div class="flex items-center">
                    <div class="px-2 py-0.5 rounded border text-[11px] font-bold z-10" 
                         style="background-color: #050810; border-color: ${color}; color: #fff; min-width: 28px; text-align: center;">
                        ${line.id}
                    </div>
                    <div class="h-1 w-6 -ml-px" style="background-color: ${color};"></div>
                    <span class="ml-3 text-slate-300 tracking-tight normal-case font-medium">${line.name}</span>
                </div>`;
            }).join('');
        }

        // --- INTERAKTIVE LOGIK ---

        function autoFit() {
            if (!viewport.clientWidth || !viewport.clientHeight) return;
            const vWidth = viewport.clientWidth - 80;
            const vHeight = viewport.clientHeight - 80;
            const scale = Math.min(vWidth / 1200, vHeight / 550, 1.0);
            updateZoom(scale);
        }

        function zoomIn() { updateZoom(zoomScale * 1.15); }
        function zoomOut() { updateZoom(zoomScale / 1.15); }
        function resetZoom() { autoFit(); }

        function updateZoom(newScale) {
            zoomScale = Math.max(0.15, Math.min(2.5, newScale));
            canvas.style.transform = `scale(${zoomScale})`;
            wrapper.style.width = (1200 * zoomScale) + 'px';
            wrapper.style.height = (550 * zoomScale) + 'px';
        }

        viewport.addEventListener('mousedown', (e) => {
            isDown = true; isDragging = false;
            startX = e.pageX - viewport.offsetLeft;
            startY = e.pageY - viewport.offsetTop;
            scrollLeft = viewport.scrollLeft;
            scrollTop = viewport.scrollTop;
        });

        window.addEventListener('mouseup', () => { isDown = false; });
        window.addEventListener('mousemove', (e) => {
            if (!isDown) return;
            const x = e.pageX - viewport.offsetLeft;
            const y = e.pageY - viewport.offsetTop;
            const walkX = (x - startX);
            const walkY = (y - startY);
            if (Math.abs(walkX) > 5 || Math.abs(walkY) > 5) isDragging = true;
            viewport.scrollLeft = scrollLeft - walkX;
            viewport.scrollTop = scrollTop - walkY;
        });

        viewport.addEventListener('touchstart', (e) => {
            if (e.touches.length === 2) {
                initialPinchDist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
            } else if (e.touches.length === 1) {
                isDown = true; isDragging = false;
                startX = e.touches[0].pageX - viewport.offsetLeft;
                startY = e.touches[0].pageY - viewport.offsetTop;
                scrollLeft = viewport.scrollLeft;
                scrollTop = viewport.scrollTop;
            }
        });

        viewport.addEventListener('touchmove', (e) => {
            if (e.touches.length === 2) {
                e.preventDefault();
                const dist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
                if (initialPinchDist > 0) updateZoom(zoomScale * (dist / initialPinchDist));
                initialPinchDist = dist;
            } else if (e.touches.length === 1 && isDown) {
                const x = e.touches[0].pageX - viewport.offsetLeft;
                const y = e.touches[0].pageY - viewport.offsetTop;
                viewport.scrollLeft = scrollLeft - (x - startX);
                viewport.scrollTop = scrollTop - (y - startY);
                if (Math.abs(x - startX) > 5 || Math.abs(y - startY) > 5) isDragging = true;
            }
        });

        viewport.addEventListener('touchend', () => { isDown = false; initialPinchDist = 0; });

        viewport.addEventListener('wheel', (e) => {
            if (e.ctrlKey) { e.preventDefault(); updateZoom(zoomScale - e.deltaY * 0.01); }
        }, { passive: false });

        // --- DRAWING ---

        function resize() { canvas.width = 1200; canvas.height = 550; draw(); }

        function fillRoundRect(x, y, w, h, radius) {
            ctx.beginPath(); ctx.moveTo(x + radius, y); ctx.lineTo(x + w - radius, y);
            ctx.quadraticCurveTo(x + w, y, x + w, y + radius); ctx.lineTo(x + w, y + h - radius);
            ctx.quadraticCurveTo(x + w, y + h, x + w - radius, y + h); ctx.lineTo(x + radius, y + h);
            ctx.quadraticCurveTo(x, y + h, x, y + h - radius); ctx.lineTo(x, y + radius);
            ctx.quadraticCurveTo(x, y, x + radius, y); ctx.closePath();
            ctx.fill(); ctx.stroke();
        }

        function drawMetroPath(ctx, x1, y1, x2, y2, r, offset, goHorizontalFirst) {
            const ox1 = x1 + offset, oy1 = y1 + offset;
            const ox2 = x2 + offset, oy2 = y2 + offset;
            if (x1 === x2 || y1 === y2) { ctx.lineTo(ox2, oy2); return; }
            if (goHorizontalFirst) ctx.arcTo(ox2, oy1, ox2, oy2, r);
            else ctx.arcTo(ox1, oy2, ox2, oy2, r);
            ctx.lineTo(ox2, oy2);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const w = 1200, h = 550;
            const lineGap = 8;
            const cornerRadius = 25;

            activeData.lines.forEach(line => {
                const col = getLineColor(line);
                ctx.strokeStyle = col; ctx.lineWidth = 4; ctx.lineCap = 'round'; ctx.lineJoin = 'round';
                const offsetVal = (lineOrder.indexOf(line.id) - (lineOrder.length - 1) / 2) * lineGap;
                for (let i = 0; i < line.stations.length - 1; i++) {
                    const p1 = coordinateMap[line.stations[i]], p2 = coordinateMap[line.stations[i + 1]];
                    if (!p1 || !p2) continue;
                    ctx.beginPath();
                    if (i === 0) {
                        const ext = line.id === "8080" ? 110 : line.id === "1024" ? 75 : 40;
                        ctx.moveTo(p1.x * w + offsetVal, p1.y * h + offsetVal - ext);
                        ctx.lineTo(p1.x * w + offsetVal, p1.y * h + offsetVal);
                    } else ctx.moveTo(p1.x * w + offsetVal, p1.y * h + offsetVal);
                    const isSpecial = line.id === "1024" && line.stations[i] === "supersonic-steig" && line.stations[i + 1] === "topic-tor";
                    drawMetroPath(ctx, p1.x * w, p1.y * h, p2.x * w, p2.y * h, cornerRadius, offsetVal, isSpecial);
                    ctx.stroke();
                }
            });

            activeData.lines.forEach(line => {
                const col = getLineColor(line);
                const p1 = coordinateMap[line.stations[0]];
                if (!p1) return;
                const offsetVal = (lineOrder.indexOf(line.id) - (lineOrder.length - 1) / 2) * lineGap;
                const ext = line.id === "8080" ? 110 : line.id === "1024" ? 75 : 40;
                const tx = p1.x * w + offsetVal, ty = p1.y * h + offsetVal - ext;
                ctx.save(); ctx.font = 'bold 11px Space Grotesk';
                const bw = ctx.measureText(line.id).width + 10;
                ctx.fillStyle = '#050810'; ctx.strokeStyle = col; ctx.lineWidth = 1.5;
                fillRoundRect(tx - bw / 2, ty - 8, bw, 16, 3);
                ctx.fillStyle = '#fff'; ctx.textAlign = 'center'; ctx.fillText(line.id, tx, ty + 4); ctx.restore();
            });

            activeData.stations.forEach(s => {
                const pos = coordinateMap[s.id];
                if (!pos) return;
                const px = pos.x * w, py = pos.y * h;
                const isH = s.id === hoveredStationId;
                if (isH) { ctx.shadowBlur = 15; ctx.shadowColor = 'rgba(255, 255, 255, 0.8)'; }
                ctx.beginPath(); ctx.arc(px, py, 14, 0, Math.PI * 2); ctx.fillStyle = '#050810'; ctx.fill();
                ctx.strokeStyle = isH ? '#fff' : 'rgba(255,255,255,0.7)'; ctx.lineWidth = 1; ctx.stroke();
                ctx.beginPath(); ctx.arc(px, py, 5, 0, Math.PI * 2); ctx.fillStyle = '#fff'; ctx.fill();
                const match = s.title.match(/^(.*)\s(\(.*\))$/);
                let lbl = match ? [match[1], match[2]] : [s.title];
                ctx.font = '600 11px Plus Jakarta Sans';
                let mw = 0; lbl.forEach(l => mw = Math.max(mw, ctx.measureText(l).width));
                const bxW = mw + 16, bxH = lbl.length * 14 + 10, bxY = py + 22;
                ctx.fillStyle = '#050810'; ctx.strokeStyle = isH ? '#fff' : 'rgba(255,255,255,0.4)';
                fillRoundRect(px - bxW / 2, bxY, bxW, bxH, 4);
                ctx.fillStyle = isH ? '#fff' : '#f8fafc'; ctx.textAlign = 'center';
                lbl.forEach((t, i) => {
                    if (i === 1) { ctx.font = '400 10px Plus Jakarta Sans'; ctx.fillStyle = isH ? '#fff' : '#94a3b8'; }
                    ctx.fillText(t, px, bxY + 14 + (i * 14));
                });
                ctx.shadowBlur = 0;
            });
        }

        viewport.addEventListener('click', (e) => {
            if (isDragging) { isDragging = false; return; }
            const s = getStationAtPos(e.clientX, e.clientY);
            if (s) openStationById(s.id);
        });

        function getStationAtPos(ex, ey) {
            const rect = canvas.getBoundingClientRect();
            const x = (ex - rect.left) / zoomScale, y = (ey - rect.top) / zoomScale;
            for (const s of activeData.stations) {
                const c = coordinateMap[s.id];
                if (!c) continue;
                const px = c.x * 1200, py = c.y * 550;
                if (Math.sqrt(Math.pow(x - px, 2) + Math.pow(y - py, 2)) < 20 || (x > px - 70 && x < px + 70 && y > py + 20 && y < py + 80)) return s;
            }
            return null;
        }

        canvas.addEventListener('mousemove', (e) => {
            const s = getStationAtPos(e.clientX, e.clientY);
            if (s) { hoveredStationId = s.id; draw(); tooltip.style.left = (e.clientX + 15) + 'px'; tooltip.style.top = (e.clientY + 15) + 'px'; tooltip.style.display = 'block'; }
            else { hoveredStationId = null; tooltip.style.display = 'none'; draw(); }
        });

        function sendConsultationEmail() {
            window.location.href = `mailto:competence-center@atvantage.com?subject=Anfrage: Cloud-Native Beratung&body=Ich interessiere mich f√ºr eine individuelle Beratung zum Trainingsfahrplan.`;
        }
        function sendInterestEmail(t, s) {
            window.location.href = `mailto:competence-center@atvantage.com?subject=Interesse an ${s}&body=Ich interessiere mich f√ºr den Kurs "${s}" (Haltestelle: ${t}). Bitte senden Sie mir Details.`;
        }

        function toggleModal(show, id = null) {
            modal.style.display = show ? 'flex' : 'none';
            document.body.style.overflow = show ? 'hidden' : 'auto';

            // Hash aktualisieren
            if (show && id) {
                window.location.hash = id;
            } else if (!show) {
                window.location.hash = 'map-section';
            }
        }

        function closeModal(e) { if (e.target.id === 'detailModal') toggleModal(false); }

        window.addEventListener('resize', () => { autoFit(); });
        window.onload = initData;
    </script>
</body>

</html>